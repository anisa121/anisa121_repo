// Translations object
const translations = {
  en: {
    title: "Peer Learning Orchestration System",
    navTitle: "Our Future - Our Kids",
    heroTitle: "Transform Classroom Learning",
    heroSubtitle: "Peer Learning & Real-Time Engagement in One App",
    heroDesc: "Empower teachers and students with intelligent peer pairing and instant feedback systems. Solve multiple classroom challenges with our iOS app designed for secondary schools.",
    heroButton: "Request Demo",
    solutionsTitle: "Two Powerful Solutions in One App",
    pathway1Title: "Pathway 1: Peer Learning Orchestration",
    pathway1Hypothesis: "Core Hypothesis:",
    pathway1Desc: "Students learn best from peers just slightly ahead of them. Our classroom-based platform intelligently pairs students for structured micro-teaching sessions during supervised class time.",
    pathway1List: [
      "Assesses mastery by topic, not overall level",
      "Creates optimal learning pairs (1-2 level gaps)",
      "Provides 10-minute structured protocols",
      "Gamified teaching practice with progress tracking"
    ],
    pathway2Title: "Pathway 2: Real-Time Engagement Thermometer",
    pathway2Hypothesis: "Core Hypothesis:",
    pathway2Desc: "Teachers can't differentiate without knowing engagement levels. A nominative real-time feedback system provides actionable data for immediate intervention.",
    pathway2List: [
      "Simple student interface: \"Lost\" / \"Need example\" / \"Got it\"",
      "Pace feedback: \"Too fast\" / \"Just right\" / \"Too slow\"",
      "Teacher dashboard with real-time, nominative data",
      "AI-suggested interventions and exercise bank"
    ],
    benefitsTitle: "Combined Benefits for Everyone",
    studentsTitle: "For Students",
    studentsList: [
      "Personalized support through peer learning",
      "Voice engagement without embarrassment",
      "Practice teaching to deepen understanding",
      "Better-paced lessons with real-time feedback"
    ],
    teachersTitle: "For Teachers",
    teachersList: [
      "Immediate, actionable feedback on engagement",
      "Multiplication of teaching capacity",
      "AI-suggested interventions and exercises",
      "Data-driven insights for lesson planning"
    ],
    parentsTitle: "For Parents",
    parentsList: [
      "Track child's progress and engagement",
      "Access to classroom insights",
      "Safe, supervised learning environment",
      "Support for differentiated education"
    ],
    safeguardsTitle: "Safety & Implementation Safeguards",
    classroomTitle: "Classroom-Only Interactions",
    classroomList: [
      "No remote connections - all activities in-person",
      "Teacher supervision at all times",
      "Structured protocols prevent disruption",
      "Rotation system prevents social dynamics issues"
    ],
    privacyTitle: "Privacy & Accountability",
    privacyList: [
      "Nominative tracking for real accountability",
      "Teacher-only visibility of responses",
      "Silent operation - no class disruption",
      "Usage analytics to detect misuse"
    ],
    challengesTitle: "Addressing Key Challenges",
    engagementTitle: "Engagement & Honesty",
    engagementDesc: "Will students take peer teaching seriously? Can nominative tracking encourage honesty without pressure?",
    engagementApproach: "Our approach:",
    engagementSolution: "Gamification, structured protocols, and teacher validation ensure meaningful participation.",
    flowTitle: "Classroom Flow",
    flowDesc: "Can teachers respond to real-time data without disrupting lessons? What's the right balance of immediate vs. post-class intervention?",
    flowApproach: "Our approach:",
    flowSolution: "Silent feedback system and AI-suggested actions that teachers can implement seamlessly.",
    timeTitle: "Time & Resources",
    timeDesc: "Will 55-minute periods provide sufficient time? How to build a comprehensive exercise bank?",
    timeApproach: "Our approach:",
    timeSolution: "10-minute micro-sessions and a growing library of ready-made differentiated activities.",
    demoTitle: "Experience the Future of Classroom Learning",
    demoDesc: "Request a personalized demo to see how our dual-pathway system can transform your school's teaching and learning experience.",
    formName: "Name",
    formSurname: "Surname",
    formEmail: "Email Address",
    formClass: "Class Level",
    formRole: "Who Applies",
    formTeacher: "Teacher",
    formParent: "Parent",
    formStudent: "Student",
    formOther: "Other",
    formButton: "Request Demo",
    footer: "&copy; 2023 OUR FUTURE - OUR KIDS. All rights reserved.",
    successMessage: "Successfully sent!",
    errorMessage: "Error sending: "
  },
  fr: {
    title: "Système d'Orchestration d'Apprentissage Pair",
    navTitle: "Notre Avenir - Nos Enfants",
    heroTitle: "Transformer l'Apprentissage en Classe",
    heroSubtitle: "Apprentissage Pair et Engagement en Temps Réel dans une Seule App",
    heroDesc: "Donnez du pouvoir aux enseignants et aux élèves avec des systèmes d'appariement pair intelligent et de retour instantané. Résolvez plusieurs défis en classe avec notre app iOS conçue pour les écoles secondaires.",
    heroButton: "Demander une Démo",
    solutionsTitle: "Deux Solutions Puissantes dans une Seule App",
    pathway1Title: "Voie 1: Orchestration d'Apprentissage Pair",
    pathway1Hypothesis: "Hypothèse Centrale:",
    pathway1Desc: "Les élèves apprennent mieux auprès de pairs légèrement en avance sur eux. Notre plateforme basée en classe apparie intelligemment les élèves pour des sessions de micro-enseignement structurées pendant le temps de classe supervisé.",
    pathway1List: [
      "Évalue la maîtrise par sujet, pas par niveau global",
      "Crée des paires d'apprentissage optimales (écarts de 1-2 niveaux)",
      "Fournit des protocoles structurés de 10 minutes",
      "Pratique d'enseignement gamifiée avec suivi des progrès"
    ],
    pathway2Title: "Voie 2: Thermomètre d'Engagement en Temps Réel",
    pathway2Hypothesis: "Hypothèse Centrale:",
    pathway2Desc: "Les enseignants ne peuvent pas différencier sans connaître les niveaux d'engagement. Un système de retour nominatif en temps réel fournit des données exploitables pour une intervention immédiate.",
    pathway2List: [
      "Interface élève simple: \"Perdu\" / \"Besoin d'exemple\" / \"Compris\"",
      "Retour sur le rythme: \"Trop rapide\" / \"Juste bien\" / \"Trop lent\"",
      "Tableau de bord enseignant avec données nominatives en temps réel",
      "Interventions suggérées par IA et banque d'exercices"
    ],
    benefitsTitle: "Avantages Combinés pour Tous",
    studentsTitle: "Pour les Élèves",
    studentsList: [
      "Soutien personnalisé grâce à l'apprentissage pair",
      "Engagement vocal sans embarras",
      "Pratique de l'enseignement pour approfondir la compréhension",
      "Leçons mieux rythmées avec retour en temps réel"
    ],
    teachersTitle: "Pour les Enseignants",
    teachersList: [
      "Retour immédiat et exploitable sur l'engagement",
      "Multiplication de la capacité d'enseignement",
      "Interventions et exercices suggérés par IA",
      "Perspectives basées sur les données pour la planification des leçons"
    ],
    parentsTitle: "Pour les Parents",
    parentsList: [
      "Suivre les progrès et l'engagement de l'enfant",
      "Accès aux perspectives de la classe",
      "Environnement d'apprentissage sûr et supervisé",
      "Soutien pour l'éducation différenciée"
    ],
    safeguardsTitle: "Sécurité et Garanties de Mise en Œuvre",
    classroomTitle: "Interactions Uniquement en Classe",
    classroomList: [
      "Pas de connexions à distance - toutes les activités en personne",
      "Supervision enseignante en permanence",
      "Protocoles structurés empêchent les perturbations",
      "Système de rotation empêche les problèmes de dynamique sociale"
    ],
    privacyTitle: "Confidentialité et Responsabilité",
    privacyList: [
      "Suivi nominatif pour une vraie responsabilité",
      "Visibilité des réponses réservée aux enseignants",
      "Fonctionnement silencieux - pas de perturbation en classe",
      "Analyses d'utilisation pour détecter les abus"
    ],
    challengesTitle: "Répondre aux Défis Clés",
    engagementTitle: "Engagement et Honnêteté",
    engagementDesc: "Les élèves prendront-ils l'enseignement pair au sérieux ? Le suivi nominatif peut-il encourager l'honnêteté sans pression ?",
    engagementApproach: "Notre approche:",
    engagementSolution: "Gamification, protocoles structurés et validation enseignante assurent une participation significative.",
    flowTitle: "Déroulement en Classe",
    flowDesc: "Les enseignants peuvent-ils répondre aux données en temps réel sans perturber les leçons ? Quel est le bon équilibre entre intervention immédiate et post-classe ?",
    flowApproach: "Notre approche:",
    flowSolution: "Système de retour silencieux et actions suggérées par IA que les enseignants peuvent implémenter de manière transparente.",
    timeTitle: "Temps et Ressources",
    timeDesc: "Les périodes de 55 minutes fourniront-elles suffisamment de temps ? Comment construire une banque d'exercices complète ?",
    timeApproach: "Notre approche:",
    timeSolution: "Micro-sessions de 10 minutes et une bibliothèque croissante d'activités différenciées prêtes à l'emploi.",
    demoTitle: "Expérimentez l'Avenir de l'Apprentissage en Classe",
    demoDesc: "Demandez une démo personnalisée pour voir comment notre système à double voie peut transformer l'expérience d'enseignement et d'apprentissage de votre école.",
    formName: "Prénom",
    formSurname: "Nom",
    formEmail: "Adresse Email",
    formClass: "Niveau de Classe",
    formRole: "Qui Postule",
    formTeacher: "Enseignant",
    formParent: "Parent",
    formStudent: "Élève",
    formOther: "Autre",
    formButton: "Demander une Démo",
    footer: "&copy; 2023 NOTRE AVENIR - NOS ENFANTS. Tous droits réservés.",
    successMessage: "Envoyé avec succès !",
    errorMessage: "Erreur d'envoi: "
  }
};

// Current language
let currentLang = localStorage.getItem('language') || 'fr';

// Ensure currentLang is valid
if (currentLang !== 'fr' && currentLang !== 'en') {
  currentLang = 'fr';
  localStorage.setItem('language', currentLang);
}

// Function to update page content
function updateContent(lang) {
  const t = translations[lang];

  if (!t) {
    console.error('Translation not found for language:', lang);
    return;
  }

  try {
    document.title = t.title;
    document.documentElement.lang = lang;

    // Navigation
    const navTitle = document.querySelector('nav h1');
    if (navTitle) navTitle.textContent = t.navTitle;

    // Hero section
    const heroTitle = document.querySelector('#hero h1');
    if (heroTitle) heroTitle.textContent = t.heroTitle;
    const heroSubtitle = document.querySelector('#hero h2');
    if (heroSubtitle) heroSubtitle.textContent = t.heroSubtitle;
    const heroDesc = document.querySelector('#hero p');
    if (heroDesc) heroDesc.textContent = t.heroDesc;
    const heroButton = document.querySelector('#hero a');
    if (heroButton) heroButton.textContent = t.heroButton;

    // Solutions section
    const solutionsTitle = document.querySelector('#solutions h3');
    if (solutionsTitle) solutionsTitle.textContent = t.solutionsTitle;
    const pathway1 = document.querySelector('#solutions .solution-card:nth-child(1)');
    if (pathway1) {
      const p1Title = pathway1.querySelector('h4');
      if (p1Title) p1Title.textContent = t.pathway1Title;
      const p1Hypothesis = pathway1.querySelector('p strong');
      if (p1Hypothesis) p1Hypothesis.textContent = t.pathway1Hypothesis;
      const p1Desc = pathway1.querySelector('p:not(.solution-card p strong)');
      if (p1Desc) p1Desc.textContent = t.pathway1Desc;
      const pathway1List = pathway1.querySelectorAll('li');
      t.pathway1List.forEach((item, index) => {
        if (pathway1List[index]) pathway1List[index].textContent = item;
      });
    }

    const pathway2 = document.querySelector('#solutions .solution-card:nth-child(2)');
    if (pathway2) {
      const p2Title = pathway2.querySelector('h4');
      if (p2Title) p2Title.textContent = t.pathway2Title;
      const p2Hypothesis = pathway2.querySelector('p strong');
      if (p2Hypothesis) p2Hypothesis.textContent = t.pathway2Hypothesis;
      const p2Desc = pathway2.querySelector('p:not(.solution-card p strong)');
      if (p2Desc) p2Desc.textContent = t.pathway2Desc;
      const pathway2List = pathway2.querySelectorAll('li');
      t.pathway2List.forEach((item, index) => {
        if (pathway2List[index]) pathway2List[index].textContent = item;
      });
    }

    // Benefits section
    const benefitsTitle = document.querySelector('#benefits h3');
    if (benefitsTitle) benefitsTitle.textContent = t.benefitsTitle;
    const students = document.querySelector('#benefits .benefit-item:nth-child(1)');
    if (students) {
      const studentsTitle = students.querySelector('h4');
      if (studentsTitle) studentsTitle.textContent = t.studentsTitle;
      const studentsList = students.querySelectorAll('li');
      t.studentsList.forEach((item, index) => {
        if (studentsList[index]) studentsList[index].textContent = item;
      });
    }

    const teachers = document.querySelector('#benefits .benefit-item:nth-child(2)');
    if (teachers) {
      const teachersTitle = teachers.querySelector('h4');
      if (teachersTitle) teachersTitle.textContent = t.teachersTitle;
      const teachersList = teachers.querySelectorAll('li');
      t.teachersList.forEach((item, index) => {
        if (teachersList[index]) teachersList[index].textContent = item;
      });
    }

    const parents = document.querySelector('#benefits .benefit-item:nth-child(3)');
    if (parents) {
      const parentsTitle = parents.querySelector('h4');
      if (parentsTitle) parentsTitle.textContent = t.parentsTitle;
      const parentsList = parents.querySelectorAll('li');
      t.parentsList.forEach((item, index) => {
        if (parentsList[index]) parentsList[index].textContent = item;
      });
    }

    // Safeguards section
    const safeguardsTitle = document.querySelector('#safeguards h3');
    if (safeguardsTitle) safeguardsTitle.textContent = t.safeguardsTitle;
    const classroom = document.querySelector('#safeguards .safeguard-item:nth-child(1)');
    if (classroom) {
      const classroomTitle = classroom.querySelector('h4');
      if (classroomTitle) classroomTitle.textContent = t.classroomTitle;
      const classroomList = classroom.querySelectorAll('li');
      t.classroomList.forEach((item, index) => {
        if (classroomList[index]) classroomList[index].textContent = item;
      });
    }

    const privacy = document.querySelector('#safeguards .safeguard-item:nth-child(2)');
    if (privacy) {
      const privacyTitle = privacy.querySelector('h4');
      if (privacyTitle) privacyTitle.textContent = t.privacyTitle;
      const privacyList = privacy.querySelectorAll('li');
      t.privacyList.forEach((item, index) => {
        if (privacyList[index]) privacyList[index].textContent = item;
      });
    }

    // Challenges section
    const challengesTitle = document.querySelector('#uncertainties h3');
    if (challengesTitle) challengesTitle.textContent = t.challengesTitle;
    const engagement = document.querySelector('#uncertainties .challenge-item:nth-child(1)');
    if (engagement) {
      const engagementTitle = engagement.querySelector('h4');
      if (engagementTitle) engagementTitle.textContent = t.engagementTitle;
      const engagementDesc = engagement.querySelector('p');
      if (engagementDesc) engagementDesc.textContent = t.engagementDesc;
      const engagementApproach = engagement.querySelector('p strong');
      if (engagementApproach) engagementApproach.textContent = t.engagementApproach;
      const engagementSolution = engagement.querySelector('p:last-child');
      if (engagementSolution) engagementSolution.textContent = t.engagementSolution;
    }

    const flow = document.querySelector('#uncertainties .challenge-item:nth-child(2)');
    if (flow) {
      const flowTitle = flow.querySelector('h4');
      if (flowTitle) flowTitle.textContent = t.flowTitle;
      const flowDesc = flow.querySelector('p');
      if (flowDesc) flowDesc.textContent = t.flowDesc;
      const flowApproach = flow.querySelector('p strong');
      if (flowApproach) flowApproach.textContent = t.flowApproach;
      const flowSolution = flow.querySelector('p:last-child');
      if (flowSolution) flowSolution.textContent = t.flowSolution;
    }

    const time = document.querySelector('#uncertainties .challenge-item:nth-child(3)');
    if (time) {
      const timeTitle = time.querySelector('h4');
      if (timeTitle) timeTitle.textContent = t.timeTitle;
      const timeDesc = time.querySelector('p');
      if (timeDesc) timeDesc.textContent = t.timeDesc;
      const timeApproach = time.querySelector('p strong');
      if (timeApproach) timeApproach.textContent = t.timeApproach;
      const timeSolution = time.querySelector('p:last-child');
      if (timeSolution) timeSolution.textContent = t.timeSolution;
    }

    // Demo section
    const demoTitle = document.querySelector('#demo h3');
    if (demoTitle) demoTitle.textContent = t.demoTitle;
    const demoDesc = document.querySelector('#demo p');
    if (demoDesc) demoDesc.textContent = t.demoDesc;

    // Form
    const nameInput = document.getElementById('name');
    if (nameInput) nameInput.placeholder = t.formName;
    const surnameInput = document.getElementById('surname');
    if (surnameInput) surnameInput.placeholder = t.formSurname;
    const emailInput = document.getElementById('email');
    if (emailInput) emailInput.placeholder = t.formEmail;
    const classInput = document.getElementById('class-level');
    if (classInput) classInput.placeholder = t.formClass;
    const roleSelect = document.getElementById('role');
    if (roleSelect) {
      const roleOption = roleSelect.querySelector('option[value=""]');
      if (roleOption) roleOption.textContent = t.formRole;
      const teacherOption = roleSelect.querySelector('option[value="teacher"]');
      if (teacherOption) teacherOption.textContent = t.formTeacher;
      const parentOption = roleSelect.querySelector('option[value="parent"]');
      if (parentOption) parentOption.textContent = t.formParent;
      const studentOption = roleSelect.querySelector('option[value="student"]');
      if (studentOption) studentOption.textContent = t.formStudent;
      const otherOption = roleSelect.querySelector('option[value="other"]');
      if (otherOption) otherOption.textContent = t.formOther;
    }
    const formButton = document.querySelector('#demo-form button');
    if (formButton) formButton.textContent = t.formButton;

    // Footer
    const footer = document.querySelector('footer p');
    if (footer) footer.innerHTML = t.footer;

    // Update button text
    const langButton = document.getElementById('lang-switch');
    if (langButton) langButton.textContent = lang === 'fr' ? 'EN' : 'FR';

  } catch (error) {
    console.error('Error updating content:', error);
  }
}

// Language switch handler
function setupLanguageSwitch() {
  const langButton = document.getElementById('lang-switch');
  if (langButton) {
    langButton.addEventListener('click', (e) => {
      e.preventDefault();
      currentLang = currentLang === 'fr' ? 'en' : 'fr';
      localStorage.setItem('language', currentLang);
      updateContent(currentLang);
    });
  } else {
    console.error('Language switch button not found');
  }
}

// Function to send data to Apps Script
async function sendToSheets(formData) {
  const params = new URLSearchParams(formData).toString();
  const response = await fetch(`https://script.google.com/macros/s/AKfycbwuzVQmKyt1zz_gJNscnmdVn5D3R6Wt72qOuCXDpcydrWipvHQF0YrOik9kFRBLsbPA/exec?${params}`);
  return response.json(); // returns JSON with {status: 'success'} or {status: 'error'}
}

// Form handler
document.getElementById('demo-form').addEventListener('submit', async (e) => {
  e.preventDefault();

  const data = {
    name: document.getElementById('name').value,
    surname: document.getElementById('surname').value,
    email: document.getElementById('email').value,
    classLevel: document.getElementById('class-level').value,
    role: document.getElementById('role').value
  };

  try {
    const result = await sendToSheets(data);

    if (result.status === 'success') {
      const t = translations[currentLang];
      alert(t.successMessage);
      document.getElementById('demo-form').reset();
    } else {
      const t = translations[currentLang];
      alert(t.errorMessage + (result.message || "Unknown error"));
      console.error(result);
    }
  } catch (error) {
    const t = translations[currentLang];
    alert(t.errorMessage + error);
    console.error(error);
  }
});

// Initialize content on page load
document.addEventListener('DOMContentLoaded', () => {
  updateContent(currentLang);
  setupLanguageSwitch();
});

// Fallback for when DOMContentLoaded has already fired
if (document.readyState === 'loading') {
  // DOM not yet loaded
} else {
  // DOM already loaded
  updateContent(currentLang);
  setupLanguageSwitch();
}
